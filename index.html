<!DOCTYPE html>
<html>

<head>
  <title>Province of Dinagat ZOD Status</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
    crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

  <link rel="stylesheet" href="./styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
    integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <style>
    #map,
    #singledropDistributionMap {
      height: 90vh;
    }

    .legend {
      padding: 10px;
      background: white;
      border-radius: 5px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    }

    .legend i {
      width: 18px;
      height: 18px;
      float: left;
      margin-right: 8px;
      opacity: 0.7;
    }
  </style>

</head>

<body>

  <section class="mb-3 shadow shadow-sm px-2 py-1">
    <div class="d-flex justify-content-between">
      <div class="d-flex justify-content-center align-items-center">
        <div class="me-2">
          <img class="pdi-logo img-thumbnail" src="./PDI_logo.png" alt="Province of Dinagat Islands" />
        </div>
        <div>
          <h5 class="m-0 p-0">Province of Dinagat Islands</h3>
            <p class="m-0 p-0">Zero Open Defication Status</p>
        </div>
      </div>


      <div class="d-flex justify-content-center align-items-center gap-2">
        <img class="singledrop-logo img-thumbnail" src="./Singledrop_logo.png" alt="Province of Dinagat Islands" />
        <button id="toggleExpansionButton" class="btn btn-outline-primary border">
          <i class="fa-solid fa-expand"></i>
        </button>
      </div>

    </div>
  </section>

  <section>
    <div class="container-fluid">
      <div class="row g-3">

        <div class="col col-md">
          <div class="card">
            <div id="map"></div>
          </div>
        </div>
        <div class="col" id="rightSideStatistics">
          <div class="row g-3">
            <div class="col">

              <div class="card shadow shadow-sm mb-3">
                <div class="card-header">
                  <h6 class="m-0 p-0">ZOD Municipalities:</h6>
                </div>
                <div class="card-body">
                  <canvas id="zodChart" class="w-100 h-100"></canvas>
                </div>
              </div>

              <div class="card shadow shadow-sm h-auto">
                <div class="card-header">
                  <h6 class="m-0 p-0">ZOD Barangays Per Municipality:</h6>
                </div>
                <div class="card-body">
                  <canvas id="zodBarangayPerMunicipalityChart" class="w-100 h-100"></canvas>
                </div>
              </div>

            </div>
            <div class="col">
              <div class="card shadow shadow-sm mb-3">
                <div class="card-header text-bg-success">
                  <h6 class="m-0 p-0">ZOD Barangays:</h6>
                </div>
                <div class="card-body py-4">
                  <h1 class="fw-bold display-1 text-center"><span class="fw-bold text-success">77</span>/100</h1>
                </div>
              </div>

              <div class="card shadow shadow-sm ">
                <div class="card-header">
                  <h6 class="m-0 p-0">ZOD Households Per Municipality:</h6>
                </div>
                <div class="card-body">
                  <canvas id="zodHouseHoldsPerMunicipalityChart" class="w-100 h-100"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="my-3">
    <div class="container-fluid">

      <div class="row g-3">
        <div class="col">
          <div class="card shadow">
            <div class="card-header">
              <div class="d-flex justify-content-between align-items-center">

                <div>
                  <h6 class="m-0 p-0 fw-bold">ZOD Monitoring By Barangay</h6>
                </div>
                <div>
                  <div class="d-flex align-items-center">
                    <label class="text-nowrap m-0 p-0 fw-semibold ">Select Municipality: </label>
                    <select class="form-select" id="municipalityDropdown">
                      <option>All</option>
                      <option>Basilisa</option>
                      <option>Cagdianao</option>
                      <option>Dinagat</option>
                      <option>Libjo</option>
                      <option>Loreto</option>
                      <option>San Jose</option>
                      <option>Tubajon</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
            <div class="card-body">
              <canvas id="zodMonitoringPerBarangayCanvas" class="w-100" style="max-height: 90vh;"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>


  <div class="offcanvas offcanvas-end p-2" tabindex="-1" id="sidebarOffcanvas" aria-labelledby="sidebarOffcanvasLabel">

    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="sidebarOffcanvasLabel">Barangay Details</h5>
      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>

    </div>

    <div class="offcanvas-body">
      <div>
        <h6>Geographical Information</h6>
        <table class="table table-sm table-bordered" id="barangayGeoInfo">
          <thead class="table-primary">
            <tr>
              <th scope="col">Attribute</th>
              <th scope="col">Value</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td># of Households</td>
              <td id="householdCountGeo">-</td>
            </tr>
            <tr>
              <td># of Without Toilet</td>
              <td id="withoutToiletCountGeo">-</td>
            </tr>
            <tr>
              <td>Barangay Name</td>
              <td id="detailBarangayNameGeo">-</td>
            </tr>
            <tr>
              <td>Municipality</td>
              <td id="detailMunicipalityGeo">-</td>
            </tr>
            <tr>
              <td>Province</td>
              <td id="detailProvinceGeo">-</td>
            </tr>
            <tr>
              <td>Region</td>
              <td id="detailRegionGeo">-</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div>
        <h6>Benificiaries</h6>
        <table class="table table-sm table-bordered table-hover" id="benificiariesTable">
          <thead class="table-secondary">
            <tr>
              <th scope="col">Name</th>
              <th scope="col">Ammount</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
      </div>
    </div>
  </div>


  <!-- LEAFLETJS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    let Benificiaries = null;

    let zodMonitoringPerBarangayChart = null;
    let geojson = null;
    const map = L.map('map', {
      minZoom: 10,
      maxZoom: 13,
    }).setView([10.10, 125.54], 11);

    // Tile Layer (Base Map)
    const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Alternative Tile Layer (Satellite Imagery)
    const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
      attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
    });

    // Create legend
    const legend = L.control({ position: 'bottomleft' });

    legend.onAdd = function (map) {
      const div = L.DomUtil.create('div', 'legend');
      div.innerHTML = `
        <h4>Map Features</h4>
        <div class="legend-item pb-1">
            <i class="legend-icon" style="background: #3388ff; border: 2px solid #3388ff"></i>
            <span>Singledrop Targets</span>
        </div>
        <div class="legend-item pb-1">
            <i class="legend-icon" style="background: orange"></i>
            <span>Non ZOD Barangays</span>
        </div>
        <div class="legend-item pb-1">
            <i class="legend-icon" style="background: green"></i>
            <span>ZOD Barangays</span>
        </div>
      `;
      return div;
    };

    legend.addTo(map);

    document.querySelector('#toggleExpansionButton').addEventListener('click', (e) => {

      e.currentTarget.classList.toggle("btn-primary");

      const rightSideStatistics = document.getElementById('rightSideStatistics');
      rightSideStatistics.classList.toggle('d-none');
      map.invalidateSize();
    });


    // Create a simple style
    function style(feature) {

      if (feature.properties.is_zod) {
        return ({
          fillColor: "green",
          weight: 3,
          opacity: 1,
          color: "black",
          dashArray: "3",
          fillOpacity: 0.5
        });
      }

      if (feature.properties.is_singledrop_target) {
        return ({
          fillColor: "blue",
          weight: 3,
          opacity: 1,
          color: "black",
          dashArray: "3",
          fillOpacity: 0.5
        });
      }

      return ({
        fillColor: "orange",
        weight: 1,
        opacity: 1,
        color: "black",
        dashArray: "3",
        fillOpacity: 0.5
      });
    }

    // Function to highlight feature on hover
    function highlightFeature(e) {
      const layer = e.target;
      layer.setStyle({
        weight: 6,
        color: '#666',
        fillOpacity: 0.7
      });

      const props = e.target.feature.properties;
      const popupContent = `
                        <h1>${props.adm4_en}</h1>
                        <b>Households: ${props.households || 0}</b><br>
                        <b>Without Toilet: ${props.no_toilet || 0}</b><br>
                        <b>Municipality: ${props.municipality}</b><br>
                        <b>${props.PROVINCE || 'Province: Dinagat Islands'}</b><br>
                        <b>${props.REGION || 'Region: Caraga Region'}</b><br>
                    `;
      layer.bindPopup(popupContent).openPopup();
    }

    // Function to reset highlight
    function resetHighlight(e) {
      geojson.resetStyle(e.target);

      map.closePopup(); // Close the popup when mouseout
    }

    // Function to bind events to each feature
    function onEachFeature(feature, layer) {
      layer.on({
        mouseover: highlightFeature,
        mouseout: resetHighlight,
        click: function (e) {

          const sidebarEl = document.getElementById('sidebarOffcanvas');
          const sidebar = new bootstrap.Offcanvas(sidebarEl);
          sidebar.toggle();

          const props = e.target.feature.properties;
          document.getElementById('householdCountGeo').textContent = props.households || '-';
          document.getElementById('withoutToiletCountGeo').textContent = props.no_toilet || '-';
          document.getElementById('detailBarangayNameGeo').textContent = props.adm4_en || '-';
          document.getElementById('detailMunicipalityGeo').textContent = props.municipality || '-';
          document.getElementById('detailProvinceGeo').textContent = props.PROVINCE || 'Dinagat Islands';
          document.getElementById('detailRegionGeo').textContent = props.REGION || 'Caraga Region';

          const barangayID = e.target.feature.id;
          const filteredBeneficiaries = Benificiaries.filter(b => b.BarangayID == barangayID);

          const benificiariesTableBody = document.querySelector('#benificiariesTable tbody');
          benificiariesTableBody.innerHTML = '';

          if (filteredBeneficiaries.length === 0) {
            const row = document.createElement('tr');
            const noDataCell = document.createElement('td');
            noDataCell.setAttribute('colspan', '2');
            noDataCell.textContent = 'No beneficiaries found';
            row.appendChild(noDataCell);
            benificiariesTableBody.appendChild(row);
          } else {
            filteredBeneficiaries.forEach(benificiary => {
              const row = document.createElement('tr');
              const nameCell = document.createElement('td');
              nameCell.textContent = benificiary.Fullname;
              const amountCell = document.createElement('td');
              amountCell.textContent = "-";
              row.appendChild(nameCell);
              row.appendChild(amountCell);
              benificiariesTableBody.appendChild(row);
            });
          }

          // const props = e.target.feature.properties;
          // const popupContent = `
          //               <h1>${props.adm4_en}</h1>
          //               <b>Households: ${props.households || 0}</b><br>
          //               <b>Without Toilet: ${props.no_toilet || 0}</b><br>
          //               <b>Municipality: ${props.municipality}</b><br>
          //               <b>${props.PROVINCE || 'Province: Dinagat Islands'}</b><br>
          //               <b>${props.REGION || 'Region: Caraga Region'}</b><br>
          //           `;
          // layer.bindPopup(popupContent).openPopup();
        }
      });
    }

    function renderZODMonitoringByBarangay(features, municipality) {

      if (zodMonitoringPerBarangayChart) {
        zodMonitoringPerBarangayChart.destroy();
        zodMonitoringPerBarangayChart = null;
      } // Destroy previous chart if it exists

      // I want to the count of households with toilet and without toilet per barangay
      // Use the same featureCollection and use the households property and without toilet property to calculate
      const zodMonitoringPerBarangay = features.reduce((acc, feature) => {
        const municipality = feature.properties.municipality;
        const barangay = feature.properties.adm4_en;
        const households = feature.properties.households || 0; // Default to 0 if not defined
        const noToilet = feature.properties.no_toilet || 0; // Default to 0 if not defined

        const formattedMunBarangay = `${municipality} - ${barangay}`;

        // Initialize barangay entry if it doesn't exist
        if (!acc[formattedMunBarangay]) {
          acc[formattedMunBarangay] = { withToilet: 0, withoutToilet: 0 };
        }

        // Increment counts
        acc[formattedMunBarangay].withToilet += households - noToilet;
        acc[formattedMunBarangay].withoutToilet += noToilet;

        return acc;
      }, {});


      // Convert to an array of { barangay, withToilet, withoutToilet } objects
      const zodMonitoringResult = Object.entries(zodMonitoringPerBarangay).map(([barangay, counts]) => ({
        barangay,
        withToilet: counts.withToilet,
        withoutToilet: counts.withoutToilet
      }));
      const zodMonitoringLabels = zodMonitoringResult.map(item => item.barangay);
      const zodMonitoringWithToilet = zodMonitoringResult.map(item => item.withToilet);
      const zodMonitoringWithoutToilet = zodMonitoringResult.map(item => item.withoutToilet);


      const zodMonitoringPerBarangayContext = document.getElementById('zodMonitoringPerBarangayCanvas').getContext('2d');
      zodMonitoringPerBarangayChart = new Chart(zodMonitoringPerBarangayContext, {
        type: 'bar',
        data: {
          labels: zodMonitoringLabels,
          datasets: [
            {
              label: 'Households With Toilet',
              data: zodMonitoringWithToilet,
              borderColor: 'rgb(62, 95, 68)',
              backgroundColor: 'rgba(62, 95, 68, 0.56)',
              borderWidth: 1
            },
            {
              label: 'Households Without Toilet',
              data: zodMonitoringWithoutToilet,
              backgroundColor: 'orange',
              borderColor: 'rgb(217, 111, 50)',
              borderWidth: 2,
            },
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
            },
            datalabels: {
              anchor: 'center',
              align: 'center',
              color: '#000',
              font: {
                weight: 'bold',
                size: 9
              },
              formatter: function (value, context) {
                return value + 'HH'; // Format the value
              }
            },
            tooltip: {
              enabled: true,
              mode: 'index',
              intersect: false
            },
            title: {
              display: true,
              text: 'Datasource: Comprehensive Household Information System (CHIS) 2025',
              font: {
                size: 19,
                weight: 'bold'
              },
            }
          },
          scales: {
            x: {
              stacked: true, // Enable stacking on x-axis
            },
            y: {
              stacked: true, // Enable stacking on y-axis
              beginAtZero: true
            }
          }
        },
        plugins: [ChartDataLabels]
      });

    }


    fetch("./beneficiaries.json")
      .then(res => res.json())
      .then(beneficiaryData => {
        Benificiaries = beneficiaryData;
      });

    fetch("./test.json")
      .then(res => res.json())
      .then(featureCollection => {

        const features = featureCollection.features;
        const municipalityMap = new Map();

        features.forEach(feature => {
          const mun = feature.properties.municipality;
          const zodStatus = feature.properties.is_zod;

          if (!municipalityMap.has(mun)) {
            municipalityMap.set(mun, zodStatus);
          } else {
            // If the municipality already exists, we can keep the ZOD status as true if it is true
            if (!zodStatus) {
              municipalityMap.set(mun, false);
            }
          }

        });

        const municipalities = Array.from(municipalityMap).map(([mun, zod_status]) => mun);
        const zod = Array.from(municipalityMap).filter(([mun, zod_status]) => zod_status).map(([mun, zod_status]) => mun);

        const non_zod = municipalities.filter(m => !zod.includes(m));

        const zodColor = "green";
        const nonZodColor = "orange";

        const backgroundColors = municipalities.map(m => {
          if (zod.includes(m)) {
            return zodColor;
          } else {
            return nonZodColor;
          }
        });

        const data = {
          labels: municipalities,
          datasets: [{
            data: municipalities.map(() => 1),
            backgroundColor: backgroundColors,
            borderWidth: 2
          }]
        };

        const config = {
          type: 'doughnut',
          data: data,
          options: {
            plugins: {
              title: {
                display: true,
                text: 'Municipalities (ZOD = Green, Non-ZOD = Orange)'
              },
              legend: {
                display: true,
                position: 'right'
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    const label = context.label || '';
                    const status = zod.includes(label) ? 'ZOD' : 'Non-ZOD';
                    return `${label} (${status}) `;
                  }
                }
              },
              datalabels: {
                color: '#fff',
                font: {
                  weight: 'bold'
                },
                formatter: function (value, context) {
                  return context.chart.data.labels[context.dataIndex];
                }
              }
            }
          },
          plugins: [ChartDataLabels]
        };

        new Chart(
          document.getElementById('zodChart'),
          config
        );


        const zodCountByMunicipality = features.reduce((acc, feature) => {
          const municipality = feature.properties.municipality;
          const isZod = feature.properties.is_zod;

          // Initialize municipality entry if it doesn't exist
          if (!acc[municipality]) {
            acc[municipality] = { total: 0, zod: 0 };
          }

          // Increment counts
          acc[municipality].total++;
          if (isZod) {
            acc[municipality].zod++;
          }

          return acc;
        }, {});

        // Convert to an array of { municipality, total, zod } objects (optional)
        const result = Object.entries(zodCountByMunicipality).map(([municipality, counts]) => ({
          municipality,
          total_barangays: counts.total,
          zod_barangays: counts.zod
        }));

        const labels = result.map(item => item.municipality);
        const zodCounts = result.map(item => item.zod_barangays);
        const totalCounts = result.map(item => item.total_barangays); // Optional (for comparison)

        const ctx = document.getElementById('zodBarangayPerMunicipalityChart').getContext('2d');
        const chart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [
              {
                label: 'ZOD Barangays',
                data: zodCounts,
                borderColor: 'rgb(62, 95, 68)',
                backgroundColor: 'rgba(62, 95, 68, 0.2)',
                tension: 0.1,
                fill: true
              },
              {
                label: 'Total Barangays',
                data: totalCounts,
                borderColor: 'rgba(54, 162, 235, 1)',
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                tension: 0.1,
                fill: true
              }
            ]
          },
          options: {
            responsive: true,
            plugins: {
              title: {
                display: false,
                text: 'ZOD Barangays per Municipality'
              },
              tooltip: {
                callbacks: {
                  label: (context) => `${context.dataset.label}: ${context.raw}`
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                title: { display: true, text: 'Number of Barangays' }
              },
              x: {
                title: { display: true, text: 'Municipality' }
              }
            }
          }
        });



        //count all the ZOD households per municipality. use the same featureCollection and use the households property and without toilet property to calculate
        const zodHouseholdsByMunicipality = features.reduce((acc, feature) => {
          const municipality = feature.properties.municipality;
          const isZod = feature.properties.is_zod;
          const households = feature.properties.households || 0; // Default to 0 if not defined
          const noToilet = feature.properties.no_toilet || 0; // Default to 0 if not defined

          // Initialize municipality entry if it doesn't exist
          if (!acc[municipality]) {
            acc[municipality] = { total: 0, zodHouseholds: 0 };
          }

          // Increment counts
          acc[municipality].total++;
          if (isZod) {
            acc[municipality].zodHouseholds += households;
          }

          return acc;
        }, {});


        const zodHouseholdsResult = Object.entries(zodHouseholdsByMunicipality).map(([municipality, counts]) => ({
          municipality,
          total_barangays: counts.total,
          zod_households: counts.zodHouseholds
        })).map(item => item.zod_households);

        const backgroundColorsV2 = municipalities.map(m => {
          if (zod.includes(m)) {
            return 'rgb(94, 147, 108)';
          } else {
            return "rgba(248, 178, 89, 0.7)";
          }
        });

        const zodHouseholdsPerMunicipalityContext = document.getElementById('zodHouseHoldsPerMunicipalityChart').getContext('2d');
        const zodHouseholdsPerMunicipalityChart = new Chart(zodHouseholdsPerMunicipalityContext, {
          type: 'polarArea',
          data: {
            labels: labels,
            datasets: [
              {
                label: 'ZOD Households',
                data: zodHouseholdsResult,
                borderColor: backgroundColorsV2,
                backgroundColor: backgroundColorsV2,
                tension: 0.1,
                fill: true
              },
            ]
          },
          options: {
            responsive: true,
            scales: {
              r: {
                pointLabels: {
                  display: true,
                  centerPointLabels: true,
                  font: {
                    size: 10
                  }
                }
              }
            },
            plugins: {
              legend: {
                display: true,
                position: 'bottom',
              },
              title: {
                display: false,
                text: 'ZOD Households per Municipality'
              }
            }
          },
        });



        document.getElementById('municipalityDropdown').addEventListener('change', (e) => {
          const selectedMunicipality = e.target.value;
          if (selectedMunicipality === 'All') {
            renderZODMonitoringByBarangay(features, null);
          } else {
            const filteredFeatures = features.filter(feature => feature.properties.municipality === selectedMunicipality);
            renderZODMonitoringByBarangay(filteredFeatures, selectedMunicipality);
          }

        });

        renderZODMonitoringByBarangay(features, null);





        // Filter features where is_zod is true
        const ZODfilteredFeatures = featureCollection.features.filter(
          feature => feature.properties.is_zod === true
        );

        // Create a new FeatureCollection with filtered features
        const ZODBarangays = {
          "type": "FeatureCollection",
          "features": ZODfilteredFeatures
        };

        // Filter features where is_zod is true
        const nonZODfilteredFeatures = featureCollection.features.filter(
          feature => feature.properties.is_zod === false
        );

        // Create a new FeatureCollection with filtered features
        const nonZODBarangays = {
          "type": "FeatureCollection",
          "features": nonZODfilteredFeatures
        };


        const basilisafilteredFeatures = featureCollection.features.filter(
          feature => feature.properties.municipality === 'Basilisa'
        );
        const cagdianaoFilteredFeatures = featureCollection.features.filter(
          feature => feature.properties.municipality === 'Cagdianao'
        );
        const dinagatFilteredFeatures = featureCollection.features.filter(
          feature => feature.properties.municipality === 'Dinagat'
        );
        const libjoFilteredFeatures = featureCollection.features.filter(
          feature => feature.properties.municipality === 'Libjo'
        );
        const loretoFilteredFeatures = featureCollection.features.filter(
          feature => feature.properties.municipality === 'Loreto'
        );
        const sanJoseFilteredFeatures = featureCollection.features.filter(
          feature => feature.properties.municipality === 'San Jose'
        );
        const tubajonFilteredFeatures = featureCollection.features.filter(
          feature => feature.properties.municipality === 'Tubajon'
        );

        const basilisaLayer = L.geoJSON(basilisafilteredFeatures, {
          style: style,
          onEachFeature: onEachFeature
        });
        const cagdianaoLayer = L.geoJSON(cagdianaoFilteredFeatures, {
          style: style,
          onEachFeature: onEachFeature
        });
        const dinagatLayer = L.geoJSON(dinagatFilteredFeatures, {
          style: style,
          onEachFeature: onEachFeature
        });
        const libjoLayer = L.geoJSON(libjoFilteredFeatures, {
          style: style,
          onEachFeature: onEachFeature
        });
        const loretoLayer = L.geoJSON(loretoFilteredFeatures, {
          style: style,
          onEachFeature: onEachFeature
        });
        const sanJoseLayer = L.geoJSON(sanJoseFilteredFeatures, {
          style: style,
          onEachFeature: onEachFeature
        });
        const tubajonLayer = L.geoJSON(tubajonFilteredFeatures, {
          style: style,
          onEachFeature: onEachFeature
        });

        zodLayer = L.geoJSON(ZODfilteredFeatures, {
          style: style,
          onEachFeature: onEachFeature
        });

        nonZODLayer = L.geoJSON(nonZODfilteredFeatures, {
          style: style,
          onEachFeature: onEachFeature
        });

        geojson = L.geoJSON(featureCollection, {
          style: style,
          onEachFeature: onEachFeature
        }).addTo(map);


        // Layer Control
        const baseLayers = {
          "OpenStreetMap": osmLayer,
          "Satellite": satelliteLayer
        };

        const overlays = {
          "Province Combined": geojson,
          "Province ZOD": zodLayer,
          "Province Non ZOD": nonZODLayer,
          "Basilisa": basilisaLayer,
          "Cagdianao": cagdianaoLayer,
          "Dinagat": dinagatLayer,
          "Libjo": libjoLayer,
          "Loreto": loretoLayer,
          "San Jose": sanJoseLayer,
          "Tubajon": tubajonLayer
        }

        L.control.layers(baseLayers, overlays).addTo(map);

        map.on('overlayadd', function (event) {
          const layer = event.layer;
          if (layer.getBounds) {
            map.fitBounds(layer.getBounds());
          }
        });



      });
  </script>


</body>

</html>
