<!DOCTYPE html>
<html>
<head>
    <title>Philippines Municipalities Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Initialize the map
        const map = L.map('map').setView([12.8797, 121.7740], 6);

        // Add OpenStreetMap base layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Create a simple style
        function style(feature) {

             if (feature.properties.is_zod) {
              return ({
                fillColor: "green",
                weight: 1,
                opacity: 1,
                color: "black",
                dashArray: "3",
                fillOpacity: 0.5
              });
            }

            return ({
              fillColor: "orange",
              weight: 1,
              opacity: 1,
              color: "black",
              dashArray: "3",
              fillOpacity: 0.5
            });
        }

        // Function to highlight feature on hover
        function highlightFeature(e) {
            const layer = e.target;
            layer.setStyle({
                weight: 6,
                color: '#666',
                fillOpacity: 0.7
            });
        }

        // Function to reset highlight
        function resetHighlight(e) {
            geojson.resetStyle(e.target);
        }

        // Function to bind events to each feature
        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: function(e) {
                    map.fitBounds(e.target.getBounds());
                    const props = e.target.feature.properties;
                    const popupContent = `
                        <b>${props.NAME_2 || 'Municipality: '}</b><br>
                        ${props.PROVINCE || 'Province: Dinagat Islands'}<br>
                        ${props.REGION || 'Region: Cataga Region'}
                    `;
                    layer.bindPopup(popupContent).openPopup();
                }
            });
        }

        // Load the GeoJSON data
        fetch('http://127.0.0.1:5500/test.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log('GeoJSON loaded:', data); // Check the data structure
                
                // Add GeoJSON layer to the map
                geojson = L.geoJson(data, {
                    style: style,
                    onEachFeature: onEachFeature
                }).addTo(map);
                
                // Fit map to GeoJSON bounds
                map.fitBounds(geojson.getBounds());
            })
            .catch(error => {
                console.error('Error loading GeoJSON:', error);
                // Fallback: Load from a CORS proxy if direct fetch fails
                fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent('https://raw.githubusercontent.com/faeldon/philippines-json-maps/master/2023/geojson/provdists/hires/municities-provdist-1608500000.0.1.json')}`)
                    .then(response => response.json())
                    .then(data => {
                        geojson = L.geoJson(data, {
                            style: style,
                            onEachFeature: onEachFeature
                        }).addTo(map);
                        map.fitBounds(geojson.getBounds());
                    })
                    .catch(proxyError => {
                        console.error('Proxy fetch failed:', proxyError);
                        alert('Failed to load map data. Please check console for details.');
                    });
            });
    </script>
</body>
</html>